<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸŒˆ AI å¥½æœ‹å‹ </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"rel="stylesheet"/>
  <link href="/static/css/style.css" rel="stylesheet">
    

</head>
<body>

  <h1>ğŸŒˆ AI å¥½æœ‹å‹ </h1>

  <div class="role-select">
    <label for="role">é¸æ“‡èº«ä»½ï¼š</label>
    <select id="role" aria-label="èº«ä»½é¸æ“‡">
      <option value="ä¸€èˆ¬äºº">ä¸€èˆ¬äºº</option>
      <option value="åœ‹å°ç”Ÿ">åœ‹å°ç”Ÿ</option>
      <option value="åœ‹ä¸­ç”Ÿ">åœ‹ä¸­ç”Ÿ</option>
      <option value="é«˜ä¸­ç”Ÿ">é«˜ä¸­ç”Ÿ</option>
    </select>
  </div>
  <div class="mb-3 d-flex flex-column align-items-center">
    <label class="form-label">å¸¸ç”¨æç¤ºèªï¼š</label>
    <div class="btn-group" role="group">
      <button type="button" class="btn custom-btn" onclick="addCommonPrompt('ç‚ºä»€éº¼')">ç‚ºä»€éº¼</button>
      <button type="button" class="btn custom-btn" onclick="addCommonPrompt('è§£é‡‹')">è§£é‡‹</button>
      <button type="button" class="btn custom-btn" onclick="addCommonPrompt('ç¯„ä¾‹')">ç¯„ä¾‹</button>
      <button type="button" class="btn custom-btn" onclick="addCommonPrompt('å»ºè­°')">å»ºè­°</button>
    </div>
  </div>
  <div class="input-area">
    <textarea
      id="question"
      rows="3"
      placeholder="è«‹è¼¸å…¥ä½ çš„å•é¡Œ..."
      maxlength="500"
      style="width: 100%; font-size: 1.2rem; border-radius: 20px; border: 2px solid #ff5c8d; padding: 15px;"
    ></textarea>
    <button id="submit">ğŸš€ å• AIï¼</button>
  </div>

  <div class="container" style="max-width: 900px;">
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card gemini">
          <div class="model-header">
            <span>ğŸ¦„ Gemini</span>
            <button class="copy-btn" data-target="gemini-response" title="è¤‡è£½ Gemini å›æ‡‰">ğŸ“‹</button>
          </div>
          <div id="gemini-response" class="response-text"></div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card chatgpt">
          <div class="model-header">
            <span>ğŸ¢ ChatGPT</span>
            <button class="copy-btn" data-target="chatgpt-response" title="è¤‡è£½ ChatGPT å›æ‡‰">ğŸ“‹</button>
          </div>
          <div id="chatgpt-response" class="response-text"></div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card grok">
          <div class="model-header">
            <span>ğŸ¦Š Grok</span>
            <button class="copy-btn" data-target="grok-response" title="è¤‡è£½ Grok å›æ‡‰">ğŸ“‹</button>
          </div>
          <div id="grok-response" class="response-text"></div>
        </div>
      </div>
    </div>
  </div>

  <section id="history">
    <h4>ğŸ“œ æ­·å²ç´€éŒ„</h4>
    <div class="history-list" id="history-list"></div>
  </section>

  <script>
    const submitBtn = document.getElementById('submit');
    const questionInput = document.getElementById('question');
    const roleSelect = document.getElementById('role');

    const geminiResp = document.getElementById('gemini-response');
    const chatgptResp = document.getElementById('chatgpt-response');
    const grokResp = document.getElementById('grok-response');

    let chatHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');

    function updateHistoryList() {
      const historyList = document.getElementById('history-list');
      historyList.innerHTML = '';
      if (chatHistory.length === 0) {
        historyList.innerHTML = '<p style="text-align:center; color:#ccc;">æš«ç„¡æ­·å²ç´€éŒ„</p>';
        return;
      }
      chatHistory
        .slice()
        .reverse()
        .forEach((record, index) => {
          const div = document.createElement('div');
          div.className = 'history-item';

          div.innerHTML = `
            <div>
              <span>${record.role}ï¼š${record.question}</span>
              <button title="åˆªé™¤æ­¤ç´€éŒ„" data-index="${index}">âŒ</button>
            </div>
            <div class="history-response gemini-response"><strong>ğŸ¦„ Geminiï¼š</strong><br>${record.responses.gemini.replace(/\n/g, '<br>')}</div>
            <div class="history-response chatgpt-response"><strong>ğŸ¢ ChatGPTï¼š</strong><br>${record.responses.chatgpt.replace(/\n/g, '<br>')}</div>
            <div class="history-response grok-response"><strong>ğŸ¦Š Grokï¼š</strong><br>${record.responses.grok.replace(/\n/g, '<br>')}</div>
          `;

          // é»æ“Šæ­·å²è¼‰å…¥
          div.addEventListener('click', (e) => {
            if (e.target.tagName.toLowerCase() === 'button') return;
            loadHistory(record);
          });
          // åˆªé™¤æŒ‰éˆ•äº‹ä»¶
          div.querySelector('button').addEventListener('click', (e) => {
            e.stopPropagation();
            deleteHistory(index);
          });

          historyList.appendChild(div);
        });
    }

    function loadHistory(record) {
      roleSelect.value = record.role;
      questionInput.value = record.question;
      geminiResp.textContent = record.responses.gemini;
      chatgptResp.textContent = record.responses.chatgpt;
      grokResp.textContent = record.responses.grok;
    }

    function deleteHistory(index) {
      // å› ç‚ºç•«é¢åè½‰é¡¯ç¤ºï¼ŒçœŸå¯¦indexéœ€è½‰æ›
      const realIndex = chatHistory.length - 1 - index;
      chatHistory.splice(realIndex, 1);
      localStorage.setItem('aiChatHistory', JSON.stringify(chatHistory));
      updateHistoryList();
    }

    async function askAI() {
      const question = questionInput.value.trim();
      if (!question) {
        alert('è«‹è¼¸å…¥å•é¡Œï¼');
        return;
      }
      const role = roleSelect.value;

      geminiResp.textContent = 'â³ Gemini æ­£åœ¨æ€è€ƒ...';
      chatgptResp.textContent = 'â³ ChatGPT æ­£åœ¨æ€è€ƒ...';
      grokResp.textContent = 'â³ Grok æ­£åœ¨æ€è€ƒ...';

      submitBtn.disabled = true;
      submitBtn.textContent = 'ç­‰å¾…å›æ‡‰ä¸­...';

      try {
        // é€™è£¡æ˜¯æ¨¡æ“¬APIï¼Œå¯¦éš›ä½¿ç”¨æ™‚æ›æˆä½ çš„å¾Œç«¯APIå‘¼å«
        const geminiReply = await fetch('/api/ai', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: question, role, model: 'gemini' }),
        }).then(res => res.json()).then(data => data.reply);

        const chatgptReply = await fetch('/api/ai', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: question, role, model: 'chatgpt' }),
        }).then(res => res.json()).then(data => data.reply);

        const grokReply = await fetch('/api/ai', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: question, role, model: 'grok' }),
        }).then(res => res.json()).then(data => data.reply);

        geminiResp.textContent = geminiReply || 'âŒ ç„¡å›æ‡‰';
        chatgptResp.textContent = chatgptReply || 'âŒ ç„¡å›æ‡‰';
        grokResp.textContent = grokReply || 'âŒ ç„¡å›æ‡‰';

        // å„²å­˜æ­·å²
        chatHistory.push({
          id: Date.now(),
          question,
          role,
          responses: {
            gemini: geminiReply || '',
            chatgpt: chatgptReply || '',
            grok: grokReply || '',
          },
        });
        localStorage.setItem('aiChatHistory', JSON.stringify(chatHistory));
        updateHistoryList();
      } catch (err) {
        geminiResp.textContent = 'âŒ å‡ºéŒ¯äº†';
        chatgptResp.textContent = 'âŒ å‡ºéŒ¯äº†';
        grokResp.textContent = 'âŒ å‡ºéŒ¯äº†';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ğŸš€ å• AIï¼';
      }
    }

    submitBtn.addEventListener('click', askAI);

    // è¤‡è£½æŒ‰éˆ•äº‹ä»¶
    document.querySelectorAll('.copy-btn').forEach((btn) => {
      btn.addEventListener('click', () => {
        const targetId = btn.getAttribute('data-target');
        const text = document.getElementById(targetId).textContent;
        navigator.clipboard.writeText(text).then(() => {
          btn.textContent = 'âœ… å·²è¤‡è£½';
          setTimeout(() => {
            btn.textContent = 'ğŸ“‹';
          }, 2000);
        });
      });
    });

    updateHistoryList();

    //æç¤ºè©æŒ‰éˆ•
         function addCommonPrompt(text) {
        const userInput = document.getElementById('question');
        userInput.value = userInput.value ? userInput.value + ' ' + text : text;
        updateCharCount();
    }       
  </script>
</body>
</html>
